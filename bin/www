#!/usr/bin/env node
var debug = require('debug')('mongotest');
var app = require('../app');

app.set('port', process.env.PORT || 3000);

var server = app.listen(app.get('port'), function() {
  debug('Express server listening on port ' + server.address().port);
});

var mongoose = require('mongoose');
mongoose.connect('mongodb://localhost/kittens');

var db = mongoose.connection;
db.on('error', console.error.bind(console, 'connection error:'));
db.once('open', function callback () {
    gettingStartedMongoose();
});

function gettingStartedMongoose() {
    var kittySchema = mongoose.Schema({
        name: String
    })
    kittySchema.methods.speak = function () {
        var greeting = this.name
            ? "Meow name is " + this.name
            : "I don't have a name"
        console.log(greeting);
    }
    var Kitten = mongoose.model('Kitten', kittySchema)
    var silence = new Kitten({ name: 'Silence' })
    silence.save(function (err, silence) {
        if (err) return console.error(err);
        silence.speak();
    });
    var fluffy = new Kitten({ name: 'Fluffy' });
    fluffy.save(function (err, fluffy) {
        if (err) return console.error(err);
        fluffy.speak();
    });
    var callback = function (err, kittens) {
        if (err) return console.error(err);
        console.log(kittens)
    };
    Kitten.find(callback)
    Kitten.find({ name: /^Fluff/ }, callback)
}
